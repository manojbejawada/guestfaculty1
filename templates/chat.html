{% extends 'base.html' %}

{% block title %}Chat with {% if other_user.user_type == 'college' %}{{ other_user.college_profile.college_name }}{%
else %}{{ other_user.faculty_profile.full_name }}{% endif %}{% endblock %}

{% block content %}
<div class="container" style="padding-top: 2rem; padding-bottom: 2rem; max-width: 800px;">
    <div
        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem;">
        <div style="display: flex; align-items: center; gap: 1rem;">
            <a href="{{ url_for('view_all_chats') }}"
                style="text-decoration: none; color: var(--text-secondary); font-size: 1.5rem;">â†</a>
            <div
                style="width: 40px; height: 40px; background: var(--bg-light); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                {% if other_user.user_type == 'college' %}ğŸ«{% else %}ğŸ‘¨â€ğŸ«{% endif %}
            </div>
            <div>
                <h2 style="margin: 0; font-size: 1.25rem;">
                    {% if other_user.user_type == 'college' %}
                    {{ other_user.college_profile.college_name }}
                    {% else %}
                    {{ other_user.faculty_profile.full_name }}
                    {% endif %}
                </h2>
                <span class="badge" style="font-size: 0.7rem; padding: 0.1rem 0.4rem;">{{
                    other_user.user_type|capitalize }}</span>
            </div>
        </div>
        {% if current_user.user_type == 'college' %}
        <a href="{{ url_for('schedule_class', faculty_id=other_user.faculty_profile.id) }}" class="btn btn-outline"
            style="font-size: 0.85rem;">
            ğŸ“… Schedule Online Class
        </a>
        {% endif %}
    </div>

    <div id="chat-window" class="chat-window">
        {% for message in messages %}
        {% set is_me = message.sender_id == current_user.id %}
        <div class="message {{ 'message-sent' if is_me else 'message-received' }}">
            <p style="margin: 0; line-height: 1.4;">{{ message.content }}</p>
            <small class="message-time">{{ message.timestamp.strftime('%H:%M') }}</small>
        </div>
        {% else %}
        <div style="text-align: center; color: var(--text-secondary); margin-top: 5rem;">
            <p>No messages yet. Say hello!</p>
        </div>
        {% endfor %}
    </div>

    <form method="POST" style="display: flex; gap: 0.5rem;">
        <input type="text" name="content" placeholder="Type your message..." required autocomplete="off"
            style="flex: 1; padding: 0.75rem 1rem; border: 1px solid var(--border-color); border-radius: 8px; outline: none;">
        <button type="submit" class="btn btn-primary" style="padding: 0.75rem 1.5rem;">Send</button>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Scroll to bottom of chat window
    const chatWindow = document.getElementById('chat-window');
    chatWindow.scrollTop = chatWindow.scrollHeight;
</script>
{% endblock %}